"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1717],{1717:(H,M,p)=>{p.r(M),p.d(M,{LocationPageModule:()=>$});var S=p(177),F=p(9417),v=p(7863),k=p(6336),_=p(467),P=p(1740),m=(p(9842),function(n){return n[n.State=0]="State",n[n.Transition=1]="Transition",n[n.Sequence=2]="Sequence",n[n.Group=3]="Group",n[n.Animate=4]="Animate",n[n.Keyframes=5]="Keyframes",n[n.Style=6]="Style",n[n.Trigger=7]="Trigger",n[n.Reference=8]="Reference",n[n.AnimateChild=9]="AnimateChild",n[n.AnimateRef=10]="AnimateRef",n[n.Query=11]="Query",n[n.Stagger=12]="Stagger",n}(m||{}));function w(n,e){return{type:m.Trigger,name:n,definitions:e,options:{}}}function B(n,e=null){return{type:m.Animate,styles:e,timings:n}}function g(n){return{type:m.Style,styles:n,offset:null}}function D(n,e,o){return{type:m.State,name:n,styles:e,options:o}}function L(n){return{type:m.Keyframes,steps:n}}function C(n,e,o=null){return{type:m.Transition,expr:n,animation:e,options:o}}var I=p(3577),c=p(4438),O=p(5312);let T=(()=>{var n;class e{constructor(){this.markers=[]}loadGoogleMaps(){const t=window,r=t.google;return r&&r.maps?Promise.resolve(r.maps):new Promise((i,s)=>{const l=document.createElement("script");l.src="https://maps.googleapis.com/maps/api/js?key="+O.c.google_map_api,l.async=!0,l.defer=!0,document.body.appendChild(l),l.onload=()=>{const d=t.google;d&&d.maps?i(d.maps):s("Google Map SDK is not available")}})}initializeMap(t,r,i){const s={center:new google.maps.LatLng(r,i),zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(t,s)}}return(n=e).\u0275fac=function(t){return new(t||n)},n.\u0275prov=c.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),e})();var G=p(8058),j=p(6469);const N=["map"];let A=(()=>{var n;class e{constructor(t,r,i,s,l,d){this.gmaps=t,this.dataCtrl=r,this.renderer=i,this.nativeCtrl=s,this.router=l,this.route=d,this.dataLoad=!1,this.translate=[],this.contents=[],this.isModalOpen=!1,this.modalType="",this.modalMarker=null,this.nearest_marker=0,this.navigation_steps=[],this.navigationClear=!0,this.navigation_total_distance="",this.navigation_total_time="",this.isNearMarker=!1,this.has_my_location=!1,this.animationState="shakestart"}ngOnInit(){}runAnimation(){this.animationState="shakestart"==this.animationState?"shakeend":"shakestart"}ngAfterViewInit(){var t=this;return(0,_.A)(function*(){t.route.queryParams.subscribe(function(){var r=(0,_.A)(function*(i){console.log("Query Params:",i);let s=i.lat?parseFloat(i.lat):46,l=i.lng?parseFloat(i.lng):16,d=i.lat?15:10;yield t.initPage(s,l,d),i.lat&&i.lng&&(console.log("Location Name:",i.locationName),t.addRedMarker(s,l))});return function(i){return r.apply(this,arguments)}}()),yield t.getData(),yield t.getMyLocation()})()}centerMap(t,r){var i=this;return(0,_.A)(function*(){yield i.map.panTo(t),yield i.map.setZoom(r)})()}extendScreen(){let t=new this.googleMaps.LatLngBounds;this.markers.map(r=>{t.extend(r.marker.getPosition())}),this.map.fitBounds(t)}clearDirection(){this.directionsRenderer.setMap(null),this.navigation_steps=[],this.navigationClear=!0,console.log("clear")}direction(t){var r=this;return(0,_.A)(function*(){let i=r.markers.find(d=>d.id==t).marker.getPosition(),s=r.markers.find(d=>0==d.id);if(null!=s){s=s.marker.getPosition();var l={origin:s,destination:i,travelMode:r.googleMaps.TravelMode.WALKING};let d=yield r.directionsService.route(l,function(f,a){if("OK"==a)return f});d&&r.writeDirection(d)}})()}writeDirection(t){var r,i;let s=(null==t||null===(r=t.routes[0])||void 0===r||null===(r=r.legs[0])||void 0===r?void 0:r.steps)||null,l=(null==t||null===(i=t.routes[0])||void 0===i?void 0:i.legs[0])||null;null!=l&&(this.navigation_total_distance=l.distance.text,this.navigation_total_time=l.duration.text),this.navigationClear=!0,null!=s&&s.length>0&&(s.map(d=>{this.navigation_steps.push({instructions:d.instructions,distance:d.distance.text,duration:d.duration.text})}),this.navigationClear=!1)}getMyLocation(){var t=this;return(0,_.A)(function*(){try{let r=yield t.nativeCtrl.getCurrentPosition(),i=r.coords.latitude,s=r.coords.longitude;t.has_my_location=!0,yield t.calculateLocation(i,s)}catch{t.has_my_location=!1}})()}calculateLocation(t,r){var i=this;return(0,_.A)(function*(){let s=i.markers.find(a=>0==a.id);if(null==s)s=i.createMarker(t,r,0,"assets/dark-green-map-pin.png"),i.markers.push({id:0,location_radius:0,distance:null,objekt:null,marker:s,type:null});else{let a=new i.googleMaps.LatLng(t,r);s.marker.setPosition(a)}i.markers.map(a=>{if(0!=a.id){let h=a.marker.getPosition().lat(),u=a.marker.getPosition().lng(),X=1e3*i.distance(t,r,h,u);a.distance=X}});let l=null,d=0,f=0;if(i.markers.map(a=>{0!=a.id&&null!=a.distance&&(null==l||a.distance<l||a.distance<l)&&(l=a.distance,d=a.id,f=a.location_radius)}),i.markers.map(a=>{0!=a.id&&(a.type="red")}),i.redrawMarkers(),0!=d)if(l<f){let a=!1;i.markers.map(h=>{0!=h.id&&h.id==d&&(h.type="green",a=!0,i.nearest_marker=d,d!=i.nearest_marker&&(i.nearest_marker=d,i.modalMarker=h,i.openModal("near_marker")))}),i.isNearMarker=a}else i.isNearMarker=!1;else i.isNearMarker=!1;console.log(i.isNearMarker),i.redrawMarkers()})()}redrawMarkers(){this.markers.map(t=>{0!=t.id&&null!=t.type&&("red"==t.type&&this.changeMarkerIcon(t.marker,"assets/red-map-pin.png"),"green"==t.type&&this.changeMarkerIcon(t.marker,"assets/green-map-pin.png"))})}changeMarkerIcon(t,r){const i={url:r,scaledSize:new this.googleMaps.Size(50,50),anchor:new this.googleMaps.Point(15,30)};t.setIcon(i)}addRedMarker(t,r){if(!this.map)return;const i=new this.googleMaps.Marker({position:{lat:t,lng:r},map:this.map,icon:{url:"https://maps.google.com/mapfiles/ms/icons/red-dot.png",scaledSize:new this.googleMaps.Size(50,50)}});this.markers.push({id:"searched-location",marker:i})}distance(t,r,i,s){var l=.017453292519943295,d=Math.cos,f=.5-d((i-t)*l)/2+d(t*l)*d(i*l)*(1-d((s-r)*l))/2;return 12742*Math.asin(Math.sqrt(f))}initPage(t,r,i){var s=this;return(0,_.A)(function*(){null==s.mapEl&&(yield s.loadMap(t,r,i)),s.renderer.addClass(s.mapEl,"visible")})()}loadMap(t,r,i){var s=this;return(0,_.A)(function*(){let l=t,d=r,f=i;try{var a;let h=yield s.gmaps.loadGoogleMaps();s.googleMaps=h,s.directionsService=new s.googleMaps.DirectionsService,s.directionsRenderer=new s.googleMaps.DirectionsRenderer,s.mapEl=null===(a=s.mapElementRef)||void 0===a?void 0:a.nativeElement;const u=new h.LatLng(l,d);s.map=new h.Map(s.mapEl,{center:u,zoom:f,disableDefaultUI:!0})}catch(h){console.log(h)}})()}createMarker(t,r,i,s="assets/red-map-pin.png"){const l=new this.googleMaps.LatLng(t,r);let d=s,f=new this.googleMaps.Size(35,40),a=new this.googleMaps.Point(12,35);const u=new this.googleMaps.Marker({position:l,map:this.map,icon:{url:d,scaledSize:f,anchor:a}});return u.custom_id=i,this.googleMaps.event.addListener(u,"click",()=>{this.handleClickMarker(u.custom_id)}),u}removeHtmlTags(t){return t&&t.replace(/<\/?[^>]+(>|$)/g,"")}getData(){var t=this;return(0,_.A)(function*(){yield t.dataCtrl.showLoader();let i=yield t.dataCtrl.getServer("/api/content/contents_main_group_offline",!0,20).catch(s=>{});if(void 0!==i&&i.data.data.length>0){let l=new P.J(i.data.data[4]);const d=`/api/content/content_offline/?id=${l.content_id}`,f=`/api/content/contents_offline/?id=${l.content_id}`;let a=yield t.dataCtrl.getServer(d,!0,20).catch(u=>{});console.log(a),null!=a&&(a.data.content_name=t.removeHtmlTags(a.data.content_name),a.data.description=t.removeHtmlTags(a.data.description),t.category=new P.J(a.data));let h=yield t.dataCtrl.getServer(f,!0,20).catch(u=>{});null!=h&&(t.contents=h.data.data.map(u=>(u.content_name=t.removeHtmlTags(u.content_name),u.content_description=t.removeHtmlTags(u.content_description),new P.J(u)))),t.defineMarkers(),t.dataLoad=!0}yield t.dataCtrl.hideLoader()})()}defineMarkers(){this.markers=[],this.contents.map(t=>{if(!t.content_location.isClear()){let r=this.createMarker(t.content_location.lat,t.content_location.lng,t.content_id,"assets/red-map-pin.png");this.markers.push({id:t.content_id,location_radius:t.content_location_radius,distance:null,objekt:t,marker:r,type:"red"})}})}handleClickMarker(t){if(console.log(t),0==t)this.openModal("click_my_location");else{let r=this.markers.find(i=>i.id==t);r&&(this.modalMarker=r,this.openModal("click_marker"))}}openText(t){var r=this;return(0,_.A)(function*(){r.closeModal(),yield r.dataCtrl.wait(300),r.router.navigate(["/text",t])})()}openModal(t){"near_marker"==t&&this.markers.map(r=>{this.nearest_marker==r.id&&(this.modalMarker=r)}),console.log(this.modalMarker),0==this.isModalOpen&&(this.modalType=t,this.isModalOpen=!0)}closeModal(){this.clearDirection(),this.isModalOpen=!1}onWillDismiss(t){this.closeModal()}}return(n=e).\u0275fac=function(t){return new(t||n)(c.rXU(T),c.rXU(G.e),c.rXU(c.sFG),c.rXU(j.b),c.rXU(k.Ix),c.rXU(k.nX))},n.\u0275cmp=c.VBU({type:n,selectors:[["app-location"]],viewQuery:function(t,r){if(1&t&&c.GBs(N,7),2&t){let i;c.mGM(i=c.lsd())&&(r.mapElementRef=i.first)}},decls:6,vars:0,consts:[["map",""],[2,"width","100%","height","100vh"],["src","assets/menu.png","alt","menu icon",1,"menu-button"]],template:function(t,r){1&t&&(c.j41(0,"ion-content"),c.nrm(1,"div",1,0),c.j41(3,"ion-menu-button"),c.nrm(4,"img",2),c.k0s(),c.nrm(5,"app-back-button"),c.k0s())},dependencies:[v.bv,v.W9,v.MC,S.MD,I.X],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%}.menu-button[_ngcontent-%COMP%]{background-color:transparent;max-width:20vmin;margin:auto;position:absolute;top:65%;left:45%;transform:translate(-50%,-50%)}ion-menu-button[_ngcontent-%COMP%]{position:absolute;top:3rem;right:1rem;height:18vmin;width:20%;--background: #a3612c;--border-radius: 50%}"],data:{animation:[w("shakeit",[D("shakestart",g({transform:"scale(1)"})),D("shakeend",g({transform:"scale(1)"})),C("shakestart <=> shakeend",B("1000ms ease-in",L([g({transform:"translate3d(-1px, 0, 0)",offset:.1}),g({transform:"translate3d(2px, 0, 0)",offset:.2}),g({transform:"translate3d(-4px, 0, 0)",offset:.3}),g({transform:"translate3d(4px, 0, 0)",offset:.4}),g({transform:"translate3d(-4px, 0, 0)",offset:.5}),g({transform:"translate3d(4px, 0, 0)",offset:.6}),g({transform:"translate3d(-4px, 0, 0)",offset:.7}),g({transform:"translate3d(2px, 0, 0)",offset:.8}),g({transform:"translate3d(-1px, 0, 0)",offset:.9})])))])]}}),e})();const z=[{path:"",component:A}];let U=(()=>{var n;class e{}return(n=e).\u0275fac=function(t){return new(t||n)},n.\u0275mod=c.$C({type:n}),n.\u0275inj=c.G2t({imports:[k.iI.forChild(z),k.iI]}),e})(),$=(()=>{var n;class e{}return(n=e).\u0275fac=function(t){return new(t||n)},n.\u0275mod=c.$C({type:n}),n.\u0275inj=c.G2t({imports:[S.MD,F.YN,v.bv,U,A]}),e})()}}]);