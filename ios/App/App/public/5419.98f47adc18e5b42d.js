"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5419],{5419:(D,C,d)=>{d.r(C),d.d(C,{AddPicturePageModule:()=>S});var y=d(177),v=d(9417),p=d(7863),A=d(6336),u=d(467),h=d(5083),g=function(r){return r.Prompt="PROMPT",r.Camera="CAMERA",r.Photos="PHOTOS",r}(g||{}),P=function(r){return r.Rear="REAR",r.Front="FRONT",r}(P||{}),x=function(r){return r.Uri="uri",r.Base64="base64",r.DataUrl="dataUrl",r}(x||{});class w extends h.E_{getPhoto(n){var c=this;return(0,u.A)(function*(){return new Promise(function(){var e=(0,u.A)(function*(t,i){if(n.webUseInput||n.source===g.Photos)c.fileInputExperience(n,t,i);else if(n.source===g.Prompt){let o=document.querySelector("pwa-action-sheet");o||(o=document.createElement("pwa-action-sheet"),document.body.appendChild(o)),o.header=n.promptLabelHeader||"Photo",o.cancelable=!1,o.options=[{title:n.promptLabelPhoto||"From Photos"},{title:n.promptLabelPicture||"Take Picture"}],o.addEventListener("onSelection",function(){var l=(0,u.A)(function*(s){0===s.detail?c.fileInputExperience(n,t,i):c.cameraExperience(n,t,i)});return function(s){return l.apply(this,arguments)}}())}else c.cameraExperience(n,t,i)});return function(t,i){return e.apply(this,arguments)}}())})()}pickImages(n){var c=this;return(0,u.A)(function*(){return new Promise(function(){var e=(0,u.A)(function*(t,i){c.multipleFileInputExperience(t,i)});return function(t,i){return e.apply(this,arguments)}}())})()}cameraExperience(n,c,e){var t=this;return(0,u.A)(function*(){if(customElements.get("pwa-camera-modal")){const i=document.createElement("pwa-camera-modal");i.facingMode=n.direction===P.Front?"user":"environment",document.body.appendChild(i);try{yield i.componentOnReady(),i.addEventListener("onPhoto",function(){var o=(0,u.A)(function*(l){const s=l.detail;null===s?e(new h.I9("User cancelled photos app")):s instanceof Error?e(s):c(yield t._getCameraPhoto(s,n)),i.dismiss(),document.body.removeChild(i)});return function(l){return o.apply(this,arguments)}}()),i.present()}catch{t.fileInputExperience(n,c,e)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),t.fileInputExperience(n,c,e)})()}fileInputExperience(n,c,e){let t=document.querySelector("#_capacitor-camera-input");const i=()=>{var o;null===(o=t.parentNode)||void 0===o||o.removeChild(t)};t||(t=document.createElement("input"),t.id="_capacitor-camera-input",t.type="file",t.hidden=!0,document.body.appendChild(t),t.addEventListener("change",o=>{const l=t.files[0];let s="jpeg";if("image/png"===l.type?s="png":"image/gif"===l.type&&(s="gif"),"dataUrl"===n.resultType||"base64"===n.resultType){const m=new FileReader;m.addEventListener("load",()=>{if("dataUrl"===n.resultType)c({dataUrl:m.result,format:s});else if("base64"===n.resultType){const _=m.result.split(",")[1];c({base64String:_,format:s})}i()}),m.readAsDataURL(l)}else c({webPath:URL.createObjectURL(l),format:s}),i()}),t.addEventListener("cancel",o=>{e(new h.I9("User cancelled photos app")),i()})),t.accept="image/*",t.capture=!0,n.source===g.Photos||n.source===g.Prompt?t.removeAttribute("capture"):n.direction===P.Front?t.capture="user":n.direction===P.Rear&&(t.capture="environment"),t.click()}multipleFileInputExperience(n,c){let e=document.querySelector("#_capacitor-camera-input-multiple");const t=()=>{var i;null===(i=e.parentNode)||void 0===i||i.removeChild(e)};e||(e=document.createElement("input"),e.id="_capacitor-camera-input-multiple",e.type="file",e.hidden=!0,e.multiple=!0,document.body.appendChild(e),e.addEventListener("change",i=>{const o=[];for(let l=0;l<e.files.length;l++){const s=e.files[l];let m="jpeg";"image/png"===s.type?m="png":"image/gif"===s.type&&(m="gif"),o.push({webPath:URL.createObjectURL(s),format:m})}n({photos:o}),t()}),e.addEventListener("cancel",i=>{c(new h.I9("User cancelled photos app")),t()})),e.accept="image/*",e.click()}_getCameraPhoto(n,c){return new Promise((e,t)=>{const i=new FileReader,o=n.type.split("/")[1];"uri"===c.resultType?e({webPath:URL.createObjectURL(n),format:o,saved:!1}):(i.readAsDataURL(n),i.onloadend=()=>{const l=i.result;e("dataUrl"===c.resultType?{dataUrl:l,format:o,saved:!1}:{base64String:l.split(",")[1],format:o,saved:!1})},i.onerror=l=>{t(l)})})}checkPermissions(){var n=this;return(0,u.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw n.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw n.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var n=this;return(0,u.A)(function*(){throw n.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var n=this;return(0,u.A)(function*(){throw n.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var n=this;return(0,u.A)(function*(){throw n.unavailable("Not implemented on web.")})()}}new w;const E=(0,h.F3)("Camera",{web:()=>new w});var O=d(7762),f=d(5312),k=d(3577),a=d(4438),U=d(1626),L=d(3656),I=d(8490);function j(r,n){if(1&r&&a.nrm(0,"img",8),2&r){const c=a.XpG();a.Y8G("src",c.base64,a.B4B)}}let M=(()=>{var r;class n{constructor(e,t,i,o,l){this.http=e,this.router=t,this.actionCtrl=i,this.dataCtrl=o,this.platform=l,this.input_text="",this.base64=null,this.imageLoad=!1,this.location={lat:0,lng:0},this.GOOGLE_API_KEY=f.c.google_map_api,this.CameraSource=g}openCamera(){var e=this;return(0,u.A)(function*(){yield(yield e.actionCtrl.create({buttons:[{text:yield e.dataCtrl.translateWord("Kamera"),handler:()=>{e.getPhoto(g.Camera)}},{text:yield e.dataCtrl.translateWord("Galerija"),handler:()=>{e.getPhoto(g.Photos)}},{text:yield e.dataCtrl.translateWord("Otka\u017ei"),role:"cancel",handler:()=>{console.log("cancel")}}]})).present()})()}getPhoto(e){var t=this;return(0,u.A)(function*(){if(1==t.platform.is("capacitor")){const i=yield E.getPhoto({quality:90,allowEditing:!0,resultType:x.Base64,source:e,correctOrientation:!1,width:1500});let o=i.format,l="";l="jpeg"==o||"jpg"==o?"image/jpeg":"image/png",t.base64="data:"+l+";base64,"+i.base64String,t.imageLoad=!0}else t.imageLoad=!0,t.base64="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAIAQMAAAD+wSzIAAAABlBMVEX///+/v7+jQ3Y5AAAADklEQVQI12P4AIX8EAgALgAD/aNpbtEAAAAASUVORK5CYII="})()}getLocation(){var e=this;return(0,u.A)(function*(){try{const t=yield O.L.getCurrentPosition();e.location={lat:t.coords.latitude,lng:t.coords.longitude}}catch(t){console.error("Error getting location:",t),alert("Failed to get location. Please ensure GPS is enabled.")}})()}saveToServer(){var e=this;return(0,u.A)(function*(){let t=yield e.dataCtrl.postServer("https://ivanic-grad-dabar.versalink-api.com/api/multimedia/attachment_key",{company_id:f.c.company_id}).catch(i=>{});if(console.log("attachment key:",t),null!=t&&"success"==(null==t?void 0:t.message)){let i=t.data.id,o=yield e.nativeCtrl.getPosition(),l="";0!=o&&(l=o.coords.latitude+","+o.coords.longitude);let s=yield e.dataCtrl.postServer("https://ivanic-grad-dabar.versalink-api.com/api/multimedia/multimedia_offline",{base_64:e.base64,company_id:f.c.company_id}).catch(m=>{});if(null!=s&&"success"==(null==s?void 0:s.message)&&""!=i){let _={attachment:"["+s.data.data+"]",attachment_key:i,company_id:f.c.company_id},T=(yield e.dataCtrl.postServer("https://ivanic-grad-dabar.versalink-api.com/api/multimedia/attachment_v2",_),{report_id:7,data_1:e.input_text,company_id:f.c.company_id,report_attachment_key:i,data_2:l});yield e.dataCtrl.postServer("https://ivanic-grad-dabar.versalink-api.com/api/report/report_offline",T).catch(B=>{})}}e.base64="",e.input_text="",e.imageLoad=!1})()}}return(r=n).\u0275fac=function(e){return new(e||r)(a.rXU(U.Qq),a.rXU(A.Ix),a.rXU(p.GD),a.rXU(I.u),a.rXU(L.OD))},r.\u0275cmp=a.VBU({type:r,selectors:[["app-add-picture"]],decls:19,vars:2,consts:[[1,"ion-padding"],["src","assets/menu.png","alt","menu icon",1,"menu-button"],[1,"container"],[3,"ngModelChange","ngModel"],["lines","none",1,"image-input",3,"click"],["class","user-image-preview",3,"src",4,"ngIf"],[3,"click"],["src","assets/menu.png","alt","menu icon",1,"card-image"],[1,"user-image-preview",3,"src"]],template:function(e,t){1&e&&(a.j41(0,"ion-content",0)(1,"ion-menu-button"),a.nrm(2,"img",1),a.k0s(),a.nrm(3,"app-back-button"),a.j41(4,"div",2)(5,"h1"),a.EFF(6,"Po\u0161alji sliku ili lokaciju"),a.k0s(),a.j41(7,"ion-label"),a.EFF(8,"Upi\u0161ite izvje\u0161taj"),a.k0s(),a.j41(9,"ion-textarea",3),a.mxI("ngModelChange",function(o){return a.DH7(t.input_text,o)||(t.input_text=o),o}),a.k0s(),a.j41(10,"ion-label"),a.EFF(11,"Dodavanje slike"),a.k0s(),a.j41(12,"ion-item",4),a.bIt("click",function(){return t.openCamera()}),a.DNE(13,j,1,1,"img",5),a.k0s(),a.j41(14,"ion-card",6),a.bIt("click",function(){return t.saveToServer()}),a.qex(15),a.nrm(16,"img",7),a.j41(17,"p"),a.EFF(18,"Unesi izvje\u0161taj"),a.k0s(),a.bVm(),a.k0s()()()),2&e&&(a.R7$(9),a.R50("ngModel",t.input_text),a.R7$(4),a.Y8G("ngIf",t.base64))},dependencies:[p.bv,p.b_,p.W9,p.uz,p.he,p.MC,p.nc,p.Gw,y.MD,y.bT,v.YN,v.BC,v.vS,k.X],styles:["ion-content[_ngcontent-%COMP%]{--background: url(/assets/app-naslovna.jpg) 0 0/100% 100% no-repeat}.container[_ngcontent-%COMP%]{background-color:#fff;border-radius:50px 50px 0 0;width:100%;min-height:70vh;display:flex;justify-content:flex-start;align-items:center;flex-direction:column;z-index:1;overflow-y:auto;position:absolute;bottom:0;right:0;padding:2rem 3rem 10rem;margin-top:10rem;box-shadow:0 -5px 15px #000000bf}h1[_ngcontent-%COMP%]{font-size:1.8rem;color:#a3622a;font-weight:900}ion-card[_ngcontent-%COMP%]{width:100%;height:10vmin;margin:1rem 0;display:flex;justify-content:flex-start;align-items:center;background-color:#a3622a;color:#fff;padding:1.5rem 0}.card-image[_ngcontent-%COMP%]{width:18%;padding-top:1rem;background-color:#7f460d;position:relative;right:.5rem}p[_ngcontent-%COMP%]{font-size:1.4rem;text-indent:.8rem;position:relative;top:3px}ion-label[_ngcontent-%COMP%]{color:#a3622a;font-weight:900;position:relative;right:5rem;top:0rem;font-size:1.2rem;margin-top:1rem}ion-input[_ngcontent-%COMP%], ion-textarea[_ngcontent-%COMP%], .image-input[_ngcontent-%COMP%]{border:1px solid #a3622a;border-radius:5px;text-align:center;width:100%;margin:1rem auto}ion-textarea[_ngcontent-%COMP%]{height:15vmin;text-align:left;text-indent:1rem;--highlight-color-focused: none;margin:0}.image-input[_ngcontent-%COMP%]{height:30vmin;--highlight-color-focused: none;margin:0}.menu-button[_ngcontent-%COMP%]{background-color:transparent;max-width:20vmin;margin:auto;position:absolute;top:65%;left:45%;transform:translate(-50%,-50%)}ion-menu-button[_ngcontent-%COMP%]{position:absolute;right:1rem;height:18vmin;width:20%;margin-top:2rem;--background: #a3612c;--border-radius: 50%}.img-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;border:1px solid #a3622a;width:100%;min-height:40vmin;max-height:60vmin;overflow:hidden}.user-image[_ngcontent-%COMP%]{width:auto;max-width:100%;max-height:100%}@media (min-width: 360px){.img-container[_ngcontent-%COMP%]{padding:2rem}.container[_ngcontent-%COMP%]{height:10vh}.image-input[_ngcontent-%COMP%]{padding:4rem}}@media (min-width: 800px){ion-menu-button[_ngcontent-%COMP%]{position:absolute;top:3rem;right:2rem;height:16vmin;width:18%}.card-image[_ngcontent-%COMP%]{width:10%;padding-top:1rem;background-color:#7f460d}}@media (min-width: 1024px){ion-menu-button[_ngcontent-%COMP%]{position:absolute;top:3rem;right:8rem;height:16vmin;width:18%}p[_ngcontent-%COMP%]{width:90%}ion-card[_ngcontent-%COMP%]{width:80%}}"]}),n})();const R=[{path:"",component:M}];let F=(()=>{var r;class n{}return(r=n).\u0275fac=function(e){return new(e||r)},r.\u0275mod=a.$C({type:r}),r.\u0275inj=a.G2t({imports:[A.iI.forChild(R),A.iI]}),n})(),S=(()=>{var r;class n{}return(r=n).\u0275fac=function(e){return new(e||r)},r.\u0275mod=a.$C({type:r}),r.\u0275inj=a.G2t({imports:[y.MD,v.YN,p.bv,F,M]}),n})()}}]);