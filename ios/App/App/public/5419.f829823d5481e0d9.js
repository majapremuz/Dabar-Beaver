"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5419],{5419:(D,_,d)=>{d.r(_),d.d(_,{AddPicturePageModule:()=>F});var A=d(177),P=d(9417),p=d(7863),y=d(6336),u=d(467),h=d(5083),g=function(r){return r.Prompt="PROMPT",r.Camera="CAMERA",r.Photos="PHOTOS",r}(g||{}),v=function(r){return r.Rear="REAR",r.Front="FRONT",r}(v||{}),x=function(r){return r.Uri="uri",r.Base64="base64",r.DataUrl="dataUrl",r}(x||{});class w extends h.E_{getPhoto(a){var c=this;return(0,u.A)(function*(){return new Promise(function(){var e=(0,u.A)(function*(t,i){if(a.webUseInput||a.source===g.Photos)c.fileInputExperience(a,t,i);else if(a.source===g.Prompt){let o=document.querySelector("pwa-action-sheet");o||(o=document.createElement("pwa-action-sheet"),document.body.appendChild(o)),o.header=a.promptLabelHeader||"Photo",o.cancelable=!1,o.options=[{title:a.promptLabelPhoto||"From Photos"},{title:a.promptLabelPicture||"Take Picture"}],o.addEventListener("onSelection",function(){var s=(0,u.A)(function*(l){0===l.detail?c.fileInputExperience(a,t,i):c.cameraExperience(a,t,i)});return function(l){return s.apply(this,arguments)}}())}else c.cameraExperience(a,t,i)});return function(t,i){return e.apply(this,arguments)}}())})()}pickImages(a){var c=this;return(0,u.A)(function*(){return new Promise(function(){var e=(0,u.A)(function*(t,i){c.multipleFileInputExperience(t,i)});return function(t,i){return e.apply(this,arguments)}}())})()}cameraExperience(a,c,e){var t=this;return(0,u.A)(function*(){if(customElements.get("pwa-camera-modal")){const i=document.createElement("pwa-camera-modal");i.facingMode=a.direction===v.Front?"user":"environment",document.body.appendChild(i);try{yield i.componentOnReady(),i.addEventListener("onPhoto",function(){var o=(0,u.A)(function*(s){const l=s.detail;null===l?e(new h.I9("User cancelled photos app")):l instanceof Error?e(l):c(yield t._getCameraPhoto(l,a)),i.dismiss(),document.body.removeChild(i)});return function(s){return o.apply(this,arguments)}}()),i.present()}catch{t.fileInputExperience(a,c,e)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),t.fileInputExperience(a,c,e)})()}fileInputExperience(a,c,e){let t=document.querySelector("#_capacitor-camera-input");const i=()=>{var o;null===(o=t.parentNode)||void 0===o||o.removeChild(t)};t||(t=document.createElement("input"),t.id="_capacitor-camera-input",t.type="file",t.hidden=!0,document.body.appendChild(t),t.addEventListener("change",o=>{const s=t.files[0];let l="jpeg";if("image/png"===s.type?l="png":"image/gif"===s.type&&(l="gif"),"dataUrl"===a.resultType||"base64"===a.resultType){const m=new FileReader;m.addEventListener("load",()=>{if("dataUrl"===a.resultType)c({dataUrl:m.result,format:l});else if("base64"===a.resultType){const C=m.result.split(",")[1];c({base64String:C,format:l})}i()}),m.readAsDataURL(s)}else c({webPath:URL.createObjectURL(s),format:l}),i()}),t.addEventListener("cancel",o=>{e(new h.I9("User cancelled photos app")),i()})),t.accept="image/*",t.capture=!0,a.source===g.Photos||a.source===g.Prompt?t.removeAttribute("capture"):a.direction===v.Front?t.capture="user":a.direction===v.Rear&&(t.capture="environment"),t.click()}multipleFileInputExperience(a,c){let e=document.querySelector("#_capacitor-camera-input-multiple");const t=()=>{var i;null===(i=e.parentNode)||void 0===i||i.removeChild(e)};e||(e=document.createElement("input"),e.id="_capacitor-camera-input-multiple",e.type="file",e.hidden=!0,e.multiple=!0,document.body.appendChild(e),e.addEventListener("change",i=>{const o=[];for(let s=0;s<e.files.length;s++){const l=e.files[s];let m="jpeg";"image/png"===l.type?m="png":"image/gif"===l.type&&(m="gif"),o.push({webPath:URL.createObjectURL(l),format:m})}a({photos:o}),t()}),e.addEventListener("cancel",i=>{c(new h.I9("User cancelled photos app")),t()})),e.accept="image/*",e.click()}_getCameraPhoto(a,c){return new Promise((e,t)=>{const i=new FileReader,o=a.type.split("/")[1];"uri"===c.resultType?e({webPath:URL.createObjectURL(a),format:o,saved:!1}):(i.readAsDataURL(a),i.onloadend=()=>{const s=i.result;e("dataUrl"===c.resultType?{dataUrl:s,format:o,saved:!1}:{base64String:s.split(",")[1],format:o,saved:!1})},i.onerror=s=>{t(s)})})}checkPermissions(){var a=this;return(0,u.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw a.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw a.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var a=this;return(0,u.A)(function*(){throw a.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var a=this;return(0,u.A)(function*(){throw a.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var a=this;return(0,u.A)(function*(){throw a.unavailable("Not implemented on web.")})()}}new w;const M=(0,h.F3)("Camera",{web:()=>new w});var O=d(7762),f=d(5312),U=d(3577),n=d(4438),L=d(1626),R=d(3656),k=d(8490);function I(r,a){if(1&r&&n.nrm(0,"img",8),2&r){const c=n.XpG();n.Y8G("src",c.base64,n.B4B)}}let E=(()=>{var r;class a{constructor(e,t,i,o,s){this.http=e,this.router=t,this.actionCtrl=i,this.dataCtrl=o,this.platform=s,this.input_text="",this.base64=null,this.imageLoad=!1,this.location={lat:0,lng:0},this.GOOGLE_API_KEY=f.c.google_map_api,this.API_URL=`${f.c.rest_server.protokol}${f.c.rest_server.host}${f.c.rest_server.functions.api}`,this.CameraSource=g}openCamera(){var e=this;return(0,u.A)(function*(){yield(yield e.actionCtrl.create({header:yield e.dataCtrl.translateWord("PHOTO.SOURCE"),buttons:[{text:yield e.dataCtrl.translateWord("PHOTO.CAMERA"),handler:()=>{e.getPhoto(g.Camera)}},{text:yield e.dataCtrl.translateWord("PHOTO.GALERY"),handler:()=>{e.getPhoto(g.Photos)}},{text:yield e.dataCtrl.translateWord("PHOTO.CANCEL"),role:"cancel",handler:()=>{console.log("cancel")}}]})).present()})()}getPhoto(e){var t=this;return(0,u.A)(function*(){if(1==t.platform.is("capacitor")){const i=yield M.getPhoto({quality:90,allowEditing:!0,resultType:x.Base64,source:e,correctOrientation:!1,width:1500});let o=i.format,s="";s="jpeg"==o||"jpg"==o?"image/jpeg":"image/png",t.base64="data:"+s+";base64,"+i.base64String,t.imageLoad=!0}else t.imageLoad=!0,t.base64="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAIAQMAAAD+wSzIAAAABlBMVEX///+/v7+jQ3Y5AAAADklEQVQI12P4AIX8EAgALgAD/aNpbtEAAAAASUVORK5CYII="})()}getLocation(){var e=this;return(0,u.A)(function*(){try{const t=yield O.L.getCurrentPosition();e.location={lat:t.coords.latitude,lng:t.coords.longitude}}catch(t){console.error("Error getting location:",t),alert("Failed to get location. Please ensure GPS is enabled.")}})()}saveToServer(){var e=this;return(0,u.A)(function*(){let t=yield e.dataCtrl.postServer("/api/multimedia/attachment_key",{}).catch(i=>{});if(null!=t&&"success"==(null==t?void 0:t.message)){let i=t.data.id,o=yield e.nativeCtrl.getPosition(),s="";0!=o&&(s=o.coords.latitude+","+o.coords.longitude);let l=yield e.dataCtrl.postServer("/api/multimedia/multimedia_offline",{base_64:e.base64}).catch(m=>{});if(null!=l&&"success"==(null==l?void 0:l.message)&&""!=i){let C={attachment:"["+l.data.data+"]",attachment_key:i},T=(yield e.dataCtrl.postServer("/api/multimedia/attachment_v2",C),{report_id:7,data_1:e.input_text,company_id:f.c.company_id,report_attachment_key:i,data_2:s});yield e.dataCtrl.postServer("/api/report/report_offline",T).catch(B=>{})}}e.base64="",e.input_text="",e.imageLoad=!1})()}}return(r=a).\u0275fac=function(e){return new(e||r)(n.rXU(L.Qq),n.rXU(y.Ix),n.rXU(p.GD),n.rXU(k.u),n.rXU(R.OD))},r.\u0275cmp=n.VBU({type:r,selectors:[["app-add-picture"]],decls:22,vars:2,consts:[[1,"ion-padding"],["src","assets/menu.png","alt","menu icon",1,"menu-button"],[1,"container"],[3,"ngModelChange","ngModel"],[3,"click"],["src","assets/menu.png","alt","menu icon",1,"card-image"],[1,"img-container"],["class","user-image",3,"src",4,"ngIf"],[1,"user-image",3,"src"]],template:function(e,t){1&e&&(n.j41(0,"ion-content",0)(1,"ion-menu-button"),n.nrm(2,"img",1),n.k0s(),n.nrm(3,"app-back-button"),n.j41(4,"div",2)(5,"h1"),n.EFF(6,"Po\u0161alji sliku ili lokaciju"),n.k0s(),n.j41(7,"ion-label"),n.EFF(8,"Upi\u0161ite izvje\u0161taj"),n.k0s(),n.j41(9,"ion-textarea",3),n.mxI("ngModelChange",function(o){return n.DH7(t.input_text,o)||(t.input_text=o),o}),n.k0s(),n.j41(10,"ion-card",4),n.bIt("click",function(){return t.openCamera()}),n.qex(11),n.nrm(12,"img",5),n.j41(13,"p"),n.EFF(14,"Dodavanje slike"),n.k0s(),n.bVm(),n.k0s(),n.j41(15,"div",6),n.DNE(16,I,1,1,"img",7),n.k0s(),n.j41(17,"ion-card",4),n.bIt("click",function(){return t.saveToServer()}),n.qex(18),n.nrm(19,"img",5),n.j41(20,"p"),n.EFF(21,"Unesi izvje\u0161taj"),n.k0s(),n.bVm(),n.k0s()()()),2&e&&(n.R7$(9),n.R50("ngModel",t.input_text),n.R7$(7),n.Y8G("ngIf",t.base64))},dependencies:[p.bv,p.b_,p.W9,p.he,p.MC,p.nc,p.Gw,A.MD,A.bT,P.YN,P.BC,P.vS,U.X],styles:["ion-content[_ngcontent-%COMP%]{--background: url(/assets/app-naslovna.jpg) 0 0/100% 100% no-repeat}.container[_ngcontent-%COMP%]{background-color:#fff;border-radius:50px 50px 0 0;width:100%;min-height:70vh;display:flex;justify-content:flex-start;align-items:center;flex-direction:column;z-index:1;overflow-y:auto;position:absolute;bottom:0;right:0;padding:2rem 3rem 10rem;margin-top:10rem}h1[_ngcontent-%COMP%]{font-size:1.8rem;color:#a3622a;font-weight:900}ion-card[_ngcontent-%COMP%]{width:100%;height:10vmin;margin:.5rem 0;display:flex;justify-content:flex-start;align-items:center;background-color:#a3622a;color:#fff;padding:1.5rem 0}.card-image[_ngcontent-%COMP%]{width:15%;padding-top:1rem;background-color:#7f460d}p[_ngcontent-%COMP%]{font-size:1.2rem;text-indent:1rem}ion-label[_ngcontent-%COMP%]{color:#a3622a;font-weight:900;position:relative;right:5rem;top:0rem;font-size:1.2rem;margin-top:1rem}ion-input[_ngcontent-%COMP%], ion-textarea[_ngcontent-%COMP%]{border:1px solid #a3622a;border-radius:5px;text-align:center;width:100%;margin:1rem auto}ion-textarea[_ngcontent-%COMP%]{height:15vmin;text-align:left;text-indent:1rem;--highlight-color-focused: none;margin:0}.menu-button[_ngcontent-%COMP%]{background-color:transparent;max-width:20vmin;margin:auto;position:absolute;top:65%;left:45%;transform:translate(-50%,-50%)}ion-menu-button[_ngcontent-%COMP%]{position:absolute;right:1rem;height:18vmin;width:20%;margin-top:2rem;--background: #a3612c;--border-radius: 50%}.img-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;border:1px solid #a3622a;width:100%;min-height:40vmin;max-height:60vmin;overflow:hidden}.user-image[_ngcontent-%COMP%]{width:auto;max-width:100%;max-height:100%}@media (min-width: 360px){.img-container[_ngcontent-%COMP%]{padding:2rem}.container[_ngcontent-%COMP%]{height:10vh}}@media (min-width: 800px){ion-menu-button[_ngcontent-%COMP%]{position:absolute;top:3rem;right:2rem;height:16vmin;width:18%}.card-image[_ngcontent-%COMP%]{width:10%;padding-top:1rem;background-color:#7f460d}}@media (min-width: 1024px){ion-menu-button[_ngcontent-%COMP%]{position:absolute;top:3rem;right:8rem;height:16vmin;width:18%}p[_ngcontent-%COMP%]{width:90%}ion-card[_ngcontent-%COMP%]{width:80%}}"]}),a})();const j=[{path:"",component:E}];let S=(()=>{var r;class a{}return(r=a).\u0275fac=function(e){return new(e||r)},r.\u0275mod=n.$C({type:r}),r.\u0275inj=n.G2t({imports:[y.iI.forChild(j),y.iI]}),a})(),F=(()=>{var r;class a{}return(r=a).\u0275fac=function(e){return new(e||r)},r.\u0275mod=n.$C({type:r}),r.\u0275inj=n.G2t({imports:[A.MD,P.YN,p.bv,S,E]}),a})()}}]);